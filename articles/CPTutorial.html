<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Learn how to get started
">
<title>Bayesian Errors-in-Variables Change-Point Linear Regression • EIVmodels</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian Errors-in-Variables Change-Point Linear Regression">
<meta property="og:description" content="Learn how to get started
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">EIVmodels</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">Vignettes</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/eivmodels.html">Basics</a>
    <a class="dropdown-item" href="../articles/CPTutorial.html">Change Point Regression</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-slides">Slides</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-slides">
    <a class="external-link dropdown-item" href="https://rpubs.com/ncahill_stat/892967">Introduction to Bayesian EIV Models</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="external-link dropdown-item" href="https://www.niamhcahill.com/post/gp_tutorial/">GP Regression</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Documentation</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="CPTutorial_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Bayesian Errors-in-Variables Change-Point Linear Regression</h1>
            
      
      
      <div class="d-none name"><code>CPTutorial.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Here I am going to give you a starting point for fitting a Bayesian errors-in-variables, change-point regression model for unevenly spaced time series data, assuming a single change point and measurement errors. We’ll start by simulating some data with a known change point and then we’ll see if the change-point model can detect it.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ncahill89.github.io/EIVmodels/">EIVmodels</a></span><span class="op">)</span></code></pre></div>
<p>Later we will use the <code>ggplot</code> and <code>tidybayes</code> packages, so make sure to load those too.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/tidybayes/" class="external-link">tidybayes</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-specification">Model specification<a class="anchor" aria-label="anchor" href="#model-specification"></a>
</h2>
<p>When it comes to the model specification recipe, the ingredients are</p>
<ol style="list-style-type: decimal">
<li><p>The <strong>process model</strong>, which relates to the expectation of what’s underlying the observed data. The process model will be governed by a set of parameters that need to be estimated.</p></li>
<li><p>The <strong>data model</strong>, which contains assumptions about how the data are generated and incorporates data uncertainty. The data model links the observed data to the underlying process.</p></li>
<li><p><strong>Priors</strong>, which contain assumptions about the parameters we are estimating. Priors can be used to impose constraints on model parameters based on apriori information.</p></li>
</ol>
<p><strong>process model</strong></p>
<p>For our specification, we’ll assume that the expected value of our observed outcome, <span class="math inline">\(y\)</span>, has a changing linear relationship with the expected x, <span class="math inline">\(\mu_x\)</span>, such that</p>
<p><span class="math inline">\(\mu_y = \alpha + \beta_1(\mu_x - cp) \hspace{2em} \text{for } \mu_x &lt; cp\)</span></p>
<p><span class="math inline">\(\mu_y = \alpha + \beta_2(\mu_x - cp) \hspace{2em} \text{for } \mu_x \geq cp\)</span></p>
<p>In other words, the linear relationship between <span class="math inline">\(\mu_x\)</span> (the expected value of x) and <span class="math inline">\(mu_y\)</span> changes at some time point (cp). The measurements of <span class="math inline">\(x\)</span> are related to <span class="math inline">\(\mu_x\)</span> via a normal distribution</p>
<p><span class="math inline">\(x \sim N(\mu_x,x_{err}^2)\)</span></p>
<p>where <span class="math inline">\(x_{err}\)</span> are the observed measurement errors.</p>
<ul>
<li>Note, by subtracting the change point (cp) from <span class="math inline">\(\mu_x\)</span> in the regression equation we can interpret the intercept (<span class="math inline">\(\alpha\)</span>) as being the expected value of y at the point where the change point occurs.</li>
</ul>
<p><strong>data model</strong></p>
<p>We’ll link the observations to the process through a normal data model.</p>
<p><span class="math inline">\(y \sim N(\mu_y, \sigma^2)\)</span></p>
<p>If we have measurement error for the ys here, which we’ll call <span class="math inline">\(y_{err}\)</span>, then we can update the data model to be</p>
<p><span class="math inline">\(y \sim N(\mu_y, \sigma^2 + y_{err}^2)\)</span></p>
<p><strong>priors</strong></p>
<p>We need priors for all unknown parameters. The prior on the change point should constrain the change point to occur somewhere within the range of the observation years.</p>
<p>If you are interested in digging deeper in to the model specification, here is the JAGS specification for this particular model, otherwise feel free to ignore this next part and move straight to the <a href="#simulate-data">Simulate data</a> section.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cp_model</span> <span class="op">&lt;-</span>
<span class="st">'model{

  ## data model
    for(j in 1:n_obs)
  {
  y[j]~dnorm(mu_y[j],tau[j])
  mu_y[j] &lt;- alpha + beta[C[j]]*(mu_x[j]-cp)
  C[j] &lt;- 1+step(mu_x[j]-cp)
  
  x[j] ~ dnorm(mu_x[j],x_err[j]^-2)
  mu_x[j] ~ dnorm(0,0.5^-2)
  
  tau[j] &lt;- (y_err[j]^2 + sigma^2)^-1
  }

  ##Priors
  alpha[1] ~ dnorm(0.0,10^-2)

  beta[1]~dnorm(0.0,10^-2)
  beta[2]~dnorm(0.0,10^-2)

  sigma ~ dt(0,4^-2,1)T(0,)

  cp ~ dunif(x_min,x_max)

  for(i in 1:n_pred)
  {
  mu_pred[i] &lt;-alpha + beta[Cstar[i]]*(x_pred[i]-cp)
  Cstar[i] &lt;- 1+step(x_pred[i]-cp)
  }
}
'</span></code></pre></div>
<p><strong>Notes on the model setup:</strong></p>
<ul>
<li><p>This setup makes use of the step function in JAGS to decide if <span class="math inline">\(\beta_1\)</span> or <span class="math inline">\(\beta_2\)</span> is required, where step(x) = 1 if <span class="math inline">\(x\geq 0\)</span> and 0 otherwise.</p></li>
<li><p>Normal distributions in JAGS are always specified with a precision parameter where precision = 1/variance.</p></li>
<li><p>I’ve add in a prediction step in the JAGS model to get model-based predictions for a grid of x values (<span class="math inline">\(x_{pred}\)</span>).</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="simulate-data">Simulate data<a class="anchor" aria-label="anchor" href="#simulate-data"></a>
</h2>
<p>One of the best ways to get a feel for a model and it’s limitations is to use simulations. We can use the <code>EIVmodels</code> package to simulate data, with measurement errors, that has a single change point. Below I’m simulating 50 data points where x ranges from 0 to 2 (by default), the change point occurs at a value of <span class="math inline">\(x = 1\)</span>, the slope = 1.1 before the change point (<span class="math inline">\(\beta_1\)</span>) and 0.1 after the change point (<span class="math inline">\(\beta_2\)</span>) . The measurement errors for <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> are set to 0.1 and 0.2 respectively.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cp_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_cp.html">sim_cp</a></span><span class="op">(</span>n_sim <span class="op">=</span> <span class="fl">50</span>,
                 alpha <span class="op">=</span> <span class="fl">0</span>,
                 beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>,<span class="fl">0.1</span><span class="op">)</span>,
                 cp <span class="op">=</span> <span class="fl">1</span>,
                 y_err <span class="op">=</span> <span class="fl">0.1</span>,
                 x_err <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>
<span class="va">cp_dat</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 50 × 6</span></span>
<span class="co">##        x x_err       y y_err  true_y true_x</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> 1.08    0.2 -<span style="color: #BB0000;">0.278</span>    0.1 -<span style="color: #BB0000;">0.155</span>   0.859</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> 0.783   0.2 -<span style="color: #BB0000;">0.083</span><span style="color: #BB0000; text-decoration: underline;">7</span>   0.1 -<span style="color: #BB0000;">0.118</span>   0.893</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> 0.579   0.2 -<span style="color: #BB0000;">0.445</span>    0.1 -<span style="color: #BB0000;">0.542</span>   0.507</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> 1.43    0.2 -<span style="color: #BB0000;">0.102</span>    0.1  0.024<span style="text-decoration: underline;">3</span>  1.24 </span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> 1.71    0.2  0.142    0.1  0.047<span style="text-decoration: underline;">5</span>  1.48 </span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> 1.67    0.2  0.196    0.1  0.074<span style="text-decoration: underline;">7</span>  1.75 </span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> 1.98    0.2  0.107    0.1  0.096<span style="text-decoration: underline;">1</span>  1.96 </span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> 0.803   0.2 -<span style="color: #BB0000;">0.518</span>    0.1 -<span style="color: #BB0000;">0.398</span>   0.638</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> 1.13    0.2  0.043<span style="text-decoration: underline;">1</span>   0.1  0.042<span style="text-decoration: underline;">2</span>  1.42 </span>
<span class="co">## <span style="color: #BCBCBC;">10</span> 1.29    0.2 -<span style="color: #BB0000;">0.042</span><span style="color: #BB0000; text-decoration: underline;">1</span>   0.1  0.016<span style="text-decoration: underline;">8</span>  1.17 </span>
<span class="co">## <span style="color: #949494;"># … with 40 more rows</span></span></code></pre>
<p>The output data will contain the simulated <span class="math inline">\(x\)</span>, <span class="math inline">\(y\)</span> data as well as the measurement errors that were supplied. It will also contain the “true” underlying process, which can be used for comparison purposes later. Here’s where you can play around with the simulation by changing the parameter values to get different datasets with varying characteristics.</p>
<p>Now, plot the simulated data and add the true underlying process that generated <span class="math inline">\(y\)</span>. When we fit the change-point regression model we are trying to estimate the “Truth” line.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_dat.html">plot_dat</a></span><span class="op">(</span><span class="va">cp_dat</span>,
         add_truth <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="CPTutorial_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="run-the-eiv-1-change-point-regression-model">Run the EIV 1-change-point regression model<a class="anchor" aria-label="anchor" href="#run-the-eiv-1-change-point-regression-model"></a>
</h2>
<p>Now we’re going to pretend that our simulated data is real life data (i.e., we don’t know the parameter values). So we want to run the model and estimate the parameters. We can then compare the true values of the parameters to the posterior distribution for the parameters to see how the model performs.</p>
<p>We can use the <code>EIVmodels</code> package to fit an EIV change-point regression model using the <code>run_mod</code> function. Specify the model argument as `model = “cp”.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod_eiv_cp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_mod.html">run_mod</a></span><span class="op">(</span><span class="va">cp_dat</span>,
                      model <span class="op">=</span> <span class="st">"cp"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## module glm loaded</span></code></pre>
<pre><code><span class="co">## Compiling model graph</span>
<span class="co">##    Resolving undeclared variables</span>
<span class="co">##    Allocating nodes</span>
<span class="co">## Graph information:</span>
<span class="co">##    Observed stochastic nodes: 100</span>
<span class="co">##    Unobserved stochastic nodes: 55</span>
<span class="co">##    Total graph size: 924</span>
<span class="co">## </span>
<span class="co">## Initializing model</span></code></pre>
<pre><code><span class="co">## No convergence issues detected</span></code></pre>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<p>We can plot the results (and add the true line) using the <code>plot_res</code> function as follows:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_res.html">plot_res</a></span><span class="op">(</span><span class="va">mod_eiv_cp</span>,
         add_truth <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="CPTutorial_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>To access the parameter summaries from the model we need to run the <code>par_est</code> function.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod_cp_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/par_est.html">par_est</a></span><span class="op">(</span>mod <span class="op">=</span> <span class="va">mod_eiv_cp</span><span class="op">)</span>
<span class="va">mod_cp_res</span><span class="op">$</span><span class="va">par_summary</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 5 × 10</span></span>
<span class="co">##   variable    mean  median     sd    mad       q5    q95  rhat ess_bulk ess_tail</span>
<span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;">1</span> alpha    -<span style="color: #BB0000;">0.041</span><span style="color: #BB0000; text-decoration: underline;">2</span> -<span style="color: #BB0000;">0.044</span><span style="color: #BB0000; text-decoration: underline;">0</span> 0.085<span style="text-decoration: underline;">9</span> 0.068<span style="text-decoration: underline;">9</span> -<span style="color: #BB0000;">0.168</span>   0.094<span style="text-decoration: underline;">7</span>  1.00     965.     932.</span>
<span class="co">## <span style="color: #BCBCBC;">2</span> beta[1]   0.979   0.963  0.150  0.140   0.774   1.24    1.00     981.     923.</span>
<span class="co">## <span style="color: #BCBCBC;">3</span> beta[2]   0.174   0.210  0.395  0.116  -<span style="color: #BB0000;">0.054</span><span style="color: #BB0000; text-decoration: underline;">0</span>  0.389   1.00    <span style="text-decoration: underline;">1</span>026.     979.</span>
<span class="co">## <span style="color: #BCBCBC;">4</span> cp        0.914   0.900  0.148  0.117   0.704   1.16    1.00     995.     937.</span>
<span class="co">## <span style="color: #BCBCBC;">5</span> sigma     0.034<span style="text-decoration: underline;">1</span>  0.028<span style="text-decoration: underline;">5</span> 0.025<span style="text-decoration: underline;">8</span> 0.026<span style="text-decoration: underline;">1</span>  0.002<span style="text-decoration: underline;">41</span> 0.082<span style="text-decoration: underline;">5</span>  1.00    <span style="text-decoration: underline;">1</span>024.     962.</span></code></pre>
<p>In this summary, q5 and q95 provide the upper and lower bounds of the 90% uncertainty intervals. Note here whether or not the 90% uncertainty intervals contain the true parameter values.</p>
<p>If you would like to get a more detailed look at the posterior distributions for the parameters you can pull the posterior samples from the model object created above and we can use the <code>tidybayes</code> package to create some plots.</p>
<p>First, get the <code>sample_draws</code> which contains the posterior samples for the parameters and the model-based estimates for the expected value of y.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod_eiv_cp</span><span class="op">$</span><span class="va">sample_draws</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 3,000 × 59</span></span>
<span class="co">##    .chain .iteration .draw    alpha `beta[1]` `beta[2]`    cp deviance</span>
<span class="co">##     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span>      1          1     1 -<span style="color: #BB0000;">0.160</span>       1.22      0.311 0.636    -<span style="color: #BB0000;">88.5</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span>      1          2     2 -<span style="color: #BB0000;">0.075</span><span style="color: #BB0000; text-decoration: underline;">5</span>      0.982     0.247 0.837    -<span style="color: #BB0000;">97.5</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span>      1          3     3 -<span style="color: #BB0000;">0.083</span><span style="color: #BB0000; text-decoration: underline;">5</span>      0.714     0.441 1.01     -<span style="color: #BB0000;">64.8</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span>      1          4     4 -<span style="color: #BB0000;">0.067</span><span style="color: #BB0000; text-decoration: underline;">8</span>      1.17      0.250 0.772    -<span style="color: #BB0000;">99.3</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span>      1          5     5  0.128       0.774     0.198 1.27     -<span style="color: #BB0000;">86.9</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span>      1          6     6 -<span style="color: #BB0000;">0.191</span>       1.16      0.322 0.704    -<span style="color: #BB0000;">76.3</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span>      1          7     7 -<span style="color: #BB0000;">0.054</span><span style="color: #BB0000; text-decoration: underline;">6</span>      0.738     0.270 0.995    -<span style="color: #BB0000;">84.0</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span>      1          8     8 -<span style="color: #BB0000;">0.006</span><span style="color: #BB0000; text-decoration: underline;">64</span>     0.812     0.174 1.12    -<span style="color: #BB0000;">111.</span> </span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span>      1          9     9 -<span style="color: #BB0000;">0.106</span>       1.01      0.325 0.829    -<span style="color: #BB0000;">83.1</span></span>
<span class="co">## <span style="color: #BCBCBC;">10</span>      1         10    10  0.132       0.917    -<span style="color: #BB0000;">0.158</span> 1.17    -<span style="color: #BB0000;">101.</span> </span>
<span class="co">## <span style="color: #949494;"># … with 2,990 more rows, and 51 more variables: `mu_pred[1]` &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   `mu_pred[2]` &lt;dbl&gt;, `mu_pred[3]` &lt;dbl&gt;, `mu_pred[4]` &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   `mu_pred[5]` &lt;dbl&gt;, `mu_pred[6]` &lt;dbl&gt;, `mu_pred[7]` &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   `mu_pred[8]` &lt;dbl&gt;, `mu_pred[9]` &lt;dbl&gt;, `mu_pred[10]` &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   `mu_pred[11]` &lt;dbl&gt;, `mu_pred[12]` &lt;dbl&gt;, `mu_pred[13]` &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   `mu_pred[14]` &lt;dbl&gt;, `mu_pred[15]` &lt;dbl&gt;, `mu_pred[16]` &lt;dbl&gt;,</span></span>
<span class="co">## <span style="color: #949494;">#   `mu_pred[17]` &lt;dbl&gt;, `mu_pred[18]` &lt;dbl&gt;, `mu_pred[19]` &lt;dbl&gt;, …</span></span></code></pre>
<p>Now let’s look at the posterior distributions for <span class="math inline">\(\beta_1\)</span> and <span class="math inline">\(\beta_2\)</span> and the change-point (cp). We’ll use the <code><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye()</a></code> function from the <code>tidybayes</code> package.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mod_eiv_cp</span><span class="op">$</span><span class="va">sample_draws</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">`beta[1]`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">tidybayes</span><span class="fu">::</span><span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<p><img src="CPTutorial_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mod_eiv_cp</span><span class="op">$</span><span class="va">sample_draws</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">`beta[2]`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">tidybayes</span><span class="fu">::</span><span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<p><img src="CPTutorial_files/figure-html/unnamed-chunk-10-2.png" width="700"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mod_eiv_cp</span><span class="op">$</span><span class="va">sample_draws</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">tidybayes</span><span class="fu">::</span><span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_halfeye.html" class="external-link">stat_halfeye</a></span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<p><img src="CPTutorial_files/figure-html/unnamed-chunk-10-3.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="what-if-we-didnt-assume-the-eiv-component-in-the-model">What if we didn’t assume the EIV component in the model?<a class="anchor" aria-label="anchor" href="#what-if-we-didnt-assume-the-eiv-component-in-the-model"></a>
</h2>
<p>If you wish the ignore the EIV component in the change-point model then you can use the <code>run_mod</code> function from the <code>EIVmodels</code> package and specify <code>EIV = FALSE</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod_cp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_mod.html">run_mod</a></span><span class="op">(</span><span class="va">cp_dat</span>,
                  model <span class="op">=</span> <span class="st">"cp"</span>,
                  EIV <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Compiling model graph</span>
<span class="co">##    Resolving undeclared variables</span>
<span class="co">##    Allocating nodes</span>
<span class="co">## Graph information:</span>
<span class="co">##    Observed stochastic nodes: 50</span>
<span class="co">##    Unobserved stochastic nodes: 5</span>
<span class="co">##    Total graph size: 809</span>
<span class="co">## </span>
<span class="co">## Initializing model</span></code></pre>
<pre><code><span class="co">## No convergence issues detected</span></code></pre>
<p>We can then compare both models to the truth.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_res.html">plot_res</a></span><span class="op">(</span><span class="va">mod_cp</span>,
         <span class="va">mod_eiv_cp</span>,
         add_truth <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="CPTutorial_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>This is a starting point for developing Bayesian change-point regression models for time dependent data with measurement error. Using simulated data can be helpful for checking if the model is doing what you expect it to do.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Niamh Cahill.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
